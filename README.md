# api_yamdb
api_yamdb
## Описание
Проект YaMDb собирает отзывы пользователей на произведения.

Возможности API: 
- Регистрация пользователей и токен авторизации (Simple JWT).
- Получение, создание, обновление, удаление учетных записей.
- Получение, создание, обновление, удаление произведений.
- Получение, создание, удаление категорий произведений и их жанров.
- Получение, создание, обновление, удаление отзывов и комментариев.

Пользовательские роли и права доступа

- Аноним — может просматривать описания произведений, читать отзывы и комментарии.
- Аутентифицированный пользователь (user) — может читать всё, как и Аноним, может публиковать отзывы и ставить оценки произведениям (фильмам/книгам/песенкам), может комментировать отзывы; может редактировать и удалять свои отзывы и комментарии, редактировать свои оценки произведений. Эта роль присваивается по умолчанию каждому новому пользователю.
- Модератор (moderator) — те же права, что и у Аутентифицированного пользователя, плюс право удалять и редактировать любые отзывы и комментарии.
- Администратор (admin) — полные права на управление всем контентом проекта. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.
- Суперюзер Django должен всегда обладать правами администратора, пользователя с правами admin. Даже если изменить пользовательскую роль суперюзера — это не лишит его прав администратора. Суперюзер — всегда администратор, но администратор — не обязательно суперюзер.

## Стек технологий:
- Django==3.2
- djangorestframework==3.12.4
- PyJWT==2.1.0
- requests==2.26.0

## Запуск проекта
- Клонируйте репозитроий с проектом:  
`git clone https://github.com/DeMoN7/api_yamdb.git`    

- В созданной директории установите виртуальное окружение, активируйте его и установите необходимые зависимости:  
`python3 -m venv venv`  
`. venv/bin/activate`  
`pip install -r requirements.txt`    

- Создайте в директории файл .env и поместите туда SECRET_KEY, необходимый для запуска проекта:  
*сгенерировать ключ можно на сайте Djecrety*

- Выполните миграции:

`python manage.py migrate`  

- Создайте суперпользователя:  
`python manage.py createsuperuser`  

- Запустите сервер:  
`python manage.py runserver`  

Ваш проект запустился на http://127.0.0.1:8000/

Полная документация (redoc.yaml) доступна по адресу http://localhost:8000/redoc/

С помощью команды pytest вы можете запустить тесты и проверить работу модулей

## Импорт данных из csv для наполнения базы:
- После развертывания проекта перейдите:  
`cd api_yamdb`

- Запустите команду импорта:  
`python manage.py load_csv_data`

Примеры файлов csv для наполнения базы находятся в папке /static/data/*.csv:

- users.csv - файл для заполнения таблицы пользователей
- titles.csv - файл для заполнения таблицы произведений.
- category.csv - файл для заполнения таблицы категорий произведений.
- genre.csv - файл для заполнения таблицы жанров произведений.
- genre_title.csv - файл для заполнения таблицы Many-to-Many: одно произведение может иметь несколько жанров.
- review.csv - файл для заполнения таблицы отзывов к произведениям.
- comments.csv - файл для заполнения таблицы комментариев к отзывам.

## Примеры запросов

- Пример запроса (POST) для регистрации пользователя

URL: http://127.0.0.1:8000/api/v1/auth/signup/

REQUEST BODY:   
{    
    "email": "user1@mail.ru",    
    "username": "user_1"   
}    

При успешном выполнении на почту прийдет код подтверждения с помощью которого можно получить токен

- Пример запроса (POST) для получения токена

URL:
REQUEST BODY:   
{   
    "username": "user_1"
    "confirmation_code": "blii7r-4f7f5d7379e5e7a3cad447dd5e650b45"   
}   

RESPONSE BODY:
{"token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjc5NTYwMjQ4LCJpYXQiOjE2Nzk1NTk5NDgsImp0aSI6IjQ5NmE1ZjIzMjE1YjQ0Njg5NTdmMDU2Y2E0MmVkNTM5IiwidXNlcl9pZCI6MTA3fQ.2K2JFmqlS0-VOpoIFSqNAQ3KfnF6QtE9BlMQ_XnkfQ4"}

- Пример запроса (GET) для получения списка категорий

URL: http://127.0.0.1:8000/api/v1/categories/

RESPONSE BODY:   
{   
    "count": 3,   
    "next": null,   
    "previous": null,   
    "results": [   
       {   
            "name": "Музыка",   
            "slug": "music"   
        },   
        {   
            "name": "Книга",   
            "slug": "book"   
        },   
        {   
            "name": "Фильм",   
            "slug": "movie"   
       }   
    ]   
}   

- Пример запроса (POST) для добавления новой категории

URL: http://127.0.0.1:8000/api/v1/categories/

AUTHORIZATIONS: 
Bearer token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjc5NTYxMjQ5LCJpYXQiOjE2Nzk1NjA5NDksImp0aSI6IjRlNmRhMTZjODA3ZDQ3N2U4YjIzNmY1ZjEyODYyZjQ4IiwidXNlcl9pZCI6MTA3fQ.AldqafeUJJb3OthdU98YNqKSdoZHdrAhnsaDZ-eK1d0

REQUEST BODY:   
{   
    "name": "NFT",   
    "slug": "nft"   
}   

RESPONSE BODY:   
{   
    "detail": "У вас недостаточно прав для выполнения данного действия."   
}   

Ошибка "У вас недостаточно прав для выполнения данного действия." - из-за того что простой пользовательн е может создавать новые категории, такими полномочиями обладает администратор и superuser.

Изменим роль user_1 на администратор и повторим запрос, но перед этим нужно получить новый токен.

RESPONSE BODY:   
{   
    "name": "NFT",   
    "slug": "nft"   
}   

- Повторим запрос всех категорий и увидим что в бд появилась новая категория

RESPONSE BODY:   
{    
    "count": 4,   
    "next": null,   
    "previous": null,   
    "results": [   
        {   
            "name": "NFT",   
            "slug": "nft"   
        },    
        {   
            "name": "Музыка",   
            "slug": "music"   
        },   
        {   
            "name": "Книга",   
            "slug": "book"   
        },   
        {   
            "name": "Фильм",   
            "slug": "movie"   
        }   
    ]   
}   
 
Более подробная информация о длоступных методах API в redoc (http://localhost:8000/redoc/)